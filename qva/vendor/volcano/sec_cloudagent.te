# Copyright (c) 2024-2025 Qualcomm Innovation Center, Inc. All rights reserved.
# SPDX-License-Identifier: BSD-3-Clause-Clear

type vendor_hal_cloudagent_qti_exec, exec_type, vendor_file_type, file_type;

# Allow for transition from init domain to vendor_hal_cloudagent_qti
init_daemon_domain(vendor_hal_cloudagent_qti)

#use bypass to allow netadmin, socket, etc permissions
hal_server_domain_bypass(vendor_hal_cloudagent_qti, vendor_hal_cloudagent)

# Allow vendor_hal_cloudagent to use Binder IPC
binder_use(vendor_hal_cloudagent)

binder_call(vendor_hal_cloudagent_client, vendor_hal_cloudagent_server)
binder_call(vendor_hal_cloudagent_server, vendor_hal_cloudagent_client)

hal_attribute_service(vendor_hal_cloudagent, vendor_hal_cloudagent_aidl_service)

allow vendor_hal_cloudagent_qti vendor_sec_vndr_data_file:file { create_file_perms };
allow vendor_hal_cloudagent_qti vendor_sec_vndr_data_file:dir { rw_dir_perms };

allow vendor_hal_cloudagent_qti vendor_aware_vndr_data_file:file { create_file_perms };
allow vendor_hal_cloudagent_qti vendor_aware_vndr_data_file:dir { rw_dir_perms };

set_prop(vendor_hal_cloudagent_qti, vendor_secca_prop);
hal_client_domain(vendor_hal_cloudagent_qti, vendor_hal_datamanager)
hal_client_domain(vendor_hal_cloudagent_qti, vendor_hal_featuremanager)
hal_client_domain(vendor_hal_cloudagent_qti, vendor_hal_provisioningmanager)

allow vendor_hal_cloudagent_qti dnsproxyd_socket:sock_file write;
allow vendor_hal_cloudagent_qti netd:unix_stream_socket connectto;
allow vendor_hal_cloudagent_qti self:udp_socket {create bind setattr setopt getopt connect };
allow vendor_hal_cloudagent_qti self:tcp_socket {create_stream_socket_perms };
allow vendor_hal_cloudagent_qti fwmarkd_socket:sock_file write;
allow vendor_hal_cloudagent_qti port:tcp_socket name_connect;
allow netd vendor_hal_cloudagent_qti:fd use;
allow netd vendor_hal_cloudagent_qti:tcp_socket { read write getopt setopt bind create setattr };
allow vendor_hal_cloudagent_qti proc_version:file getattr;
